{{ 'section.single-product.css' | asset_url | stylesheet_tag }}
{{ 'drawer.product.css' | asset_url | stylesheet_tag }}
{{ 'drawer.quantity.css' | asset_url | stylesheet_tag }}

{% assign default_variant = product.selected_or_first_available_variant %}
{% assign price = default_variant.price | default: product.price %}
{% assign compare_at_price = default_variant.compare_at_price | default: product.compare_at_price %}

<div ui-section="single-product">
  {% if product.images.size > 1 %}
    <ui-drawer id="gallery">
  {% endif %}
  <div
    class="media"
    ui-drawer="trigger"
    data-for="gallery"
    data-state="open"
  >
    <ul class="slides">
      {% if product.images.size %}
        {% for img in product.images %}
          <li class="slide">
            <div class="image">
              <img
                src="{{ img }}"
                alt="{{ product.name }}"
                height="100%"
                width="100%"
              >
            </div>
          </li>
        {% endfor %}
      {% else %}
        <li class="slide">
          <div class="image">
            {% render 'misc.image-fallback' %}
          </div>
        </li>
      {% endif %}
    </ul>
    {% if product.images.size > 1 %}
      <div class="pagination"><span class="index">1</span> / <span class="total"></span>{{ product.images.size }}</div>
      {% render 'drawer.gallery', images: product.images %}
    {% endif %}
  </div>
  {% if product.images.size > 1 %}
    </ui-drawer>
  {% endif %}
  <ui-product product-id="{{ product.id }}" class="content">
    <div class="bio">
      <h1 class="title">{{ product.name }}</h1>
      <div class="about">
        <div class="rating">
          <span class="value">{{ product.averageRating }}</span>
          <div class="stars">
            {% for star in (1..5) %}
              {% if star <= product.averageRating %}
                {% render 'icon.star', size: 10 %}
              {% else %}
                <i class="hgi hgi-stroke hgi-star"></i>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        <div class="inventory">
          <div class="status"><span class="dot">·</span> Low stock</div>
        </div>
        <div class="total-reviews">
          <span class="value">39</span>
          <span class="label">Reviews</span>
        </div>
      </div>
    </div>
    {% if product.options.size > 0 %}
      {% render 'misc.variants' %}
    {% endif %}
    {% if product.description %}
      <article class="description">
        {{ product.description }}
      </article>
    {% endif %}
    {% for block in section.blocks %}
      {% if block.type == 'reviews' %}
        <div class="reviews" {{ block.youcan_attributes }}>
          <div class="reviews-overview">
            <div class="rating">
              {% render 'icon.star', size: 20 %}
              <span class="value">{{ product.averageRating }}</span>
            </div>
            <span class="separator">·</span>
            <span class="total">90 reviews</span>
          </div>
          <ul class="cards">
            {% for review in (1..5) %}
              <li class="card">
                <div class="rating">
                  <div class="stars">
                    {% for star in (1..5) %}
                      {% if forloop.index < 4 %}
                        {% render 'icon.star', size: 14 %}
                      {% else %}
                        <i class="hgi hgi-stroke hgi-star"></i>
                      {% endif %}
                    {% endfor %}
                  </div>
                  <span class="separator">·</span>
                  <span class="date">1 week ago</span>
                </div>
                <article>
                  <p>
                    We had a lovely stay in the cabin in the woods! The cabin was surrounded by gorgeous countryside and
                    in a perfect location to see all the idyllic villages of the Cotswolds.
                  </p>
                </article>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% elsif block.type == 'note' %}
        <div class="note" {{ block.youcan_attributes }}>
          {% render 'icon.note', size: 24 %}
          <span class="value">The cabin was surrounded by gorgeous</span>
        </div>
      {% endif %}
    {% endfor %}

    <div class="events">
      <div class="price">
        <span class="original" ui-product-item="price">{{ price | default: 0 | money }}</span>
        {% if compare_at_price %}
          <span class="compare-at" ui-product-item="compare-at-price">
            {{ compare_at_price | default: 0 | money }}
          </span>
        {% endif %}
      </div>
      <div class="actions">
        {% render 'core.buy-now' %}
        {% render 'core.product-button' %}
      </div>
    </div>
    {% for block in section.blocks %}
      {% if block.type == 'related_products' %}
        <div class="related-products" {{ block.youcan_attributes }}>
          <div class="nav">
            <h4 class="title">Related Products</h4>
          </div>
          <ul class="products">
            {% for block in (1..4) %}
              {% render 'block.product' %}
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    {% endfor %}
  </ui-product>
</div>

{% if product and product.options.size %}
  {% javascript %}
    if (!window.productsVariants["{{ product.id }}"]) {
      window.productsVariants["{{ product.id }}"] = JSON.parse({{ product.variants | json }});
    }
  {% endjavascript %}
{% endif %}

{% schema %}
{
  "label": "Single Product",
  "blocks": [
    {
      "type": "note",
      "label": "Note",
      "limit": 1,
      "settings": []
    },
    {
      "type": "reviews",
      "label": "Reviews",
      "limit": 1,
      "settings": []
    },
    {
      "type": "related_products",
      "label": "Related products",
      "limit": 1,
      "settings": []
    }
  ]
}
{% endschema %}
