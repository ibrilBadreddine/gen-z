{{ 'drawer.filter.css' | asset_url | stylesheet_tag }}

{% comment %}
  Renders a filter drawer

  Usage:
  {% render 'drawer.filter' %}
{% endcomment %}

{% assign sort_field = '' %}
{% assign sort_order = '' -%}
{% assign query_params = url | split: '?' | last | split: '&' %}

{% for param in query_params %}
  {% if param contains 'sort_field=' %}
    {% assign sort_field = param | split: '=' | last %}
  {% elsif param contains 'sort_order=' %}
    {% assign sort_order = param | split: '=' | last %}
  {% endif %}
{% endfor %}

{% assign alphabetical_asc = 'general.sort.alphabetical_asc' | t %}
{% assign alphabetical_desc = 'general.sort.alphabetical_desc' | t %}
{% assign oldest = 'general.sort.oldest' | t %}
{% assign newest = 'general.sort.newest' | t %}
{% assign price_low_high = 'general.sort.price_low_high' | t %}
{% assign price_high_low = 'general.sort.price_high_low' | t %}

{% capture labels %}
  {{ alphabetical_asc }}, {{ alphabetical_desc }}, {{ oldest }}, {{ newest }}, {{ price_low_high }}, {{ price_high_low }}
{% endcapture -%}

{% assign keys = ',name,name,created_at,created_at,price,price' | split: ',' %}
{% assign values = 'desc,asc' | split: ',' %}
{% assign options = labels | split: ',' %}

<div ui-drawer="content" class="drawer-filter">
  <div class="head">
    <div class="info">
      <h4 class="title">Sort by</h4>
    </div>
    <button
      ui-drawer="trigger"
      data-for="filter"
      data-state="close"
      ui-button
      data-variant="ghost"
      data-size="xs"
      data-icon
      aria-label="close"
    >
      <i class="hgi hgi-stroke hgi-cancel-01"></i>
    </button>
  </div>
  <div class="core">
    <ul class="sort-options">
      {% for opt in options %}
        {% assign index = forloop.index %}
        {% assign field = keys[index] %}
        {% assign order = index | modulo: 2 == 0 %}
        {% assign href = '?sort_field=' | append: field | append: '&sort_order=' | append: values[order] %}
        {% unless terms == null or terms == '' %}
          {% assign href = href | append: '&q=' | append: terms %}
        {% endunless %}

        <li class="opt">
          <a
            href="{{ href }}"
            ui-button
            {% if field == sort_field and values[order] == sort_order %}
              data-variant="secondary"
            {% else %}
              data-variant="ghost"
            {% endif %}
            data-size="md"
          >
            <input
              ui-radio
              type="radio"
              name="sort"
              value="{{opt}}"
              {% if field == sort_field and values[order] == sort_order %}
                checked
              {% endif %}
            >
            {{ opt }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
